#!perl

use strict;
use warnings;

use SPVM();
use SPVM::Builder::Exe;
use SPVM::Builder::Util;

SPVM::Builder::Util::getopt
  'h|help'          => \my $help,
  'v|version'       => \my $show_version,
  'o|output=s'        => \my $output_file,
  'B|build-dir=s'   => \my $build_dir,
  'I|module-dir=s' => \my @module_dirs,
  'L|lib-dir=s' => \my @lib_dirs,
  'l|lib=s' => \my @libs,
  'q|quiet'   => \my $quiet,
  'D|define=s' => \my @defines,
  'O|optimize=s' => \my $optimize,
;

die SPVM::Builder::Util::extract_usage if $help || !(my $target_package_name = shift);

unshift @module_dirs, @INC;

unless (defined $build_dir) {
  $build_dir = '.spvm_build';
}

my $build_exe = SPVM::Builder::Exe->new(
  build_dir => $build_dir,
  module_dirs => \@module_dirs,
  output_file => $output_file,
  target_package_name => $target_package_name,
  quiet => $quiet,
  lib_dirs => \@lib_dirs,
  libs => \@libs,
  define => \@defines,
  optimize => $optimize,
);
$build_exe->build_exe_file;

=encoding utf8

=head1 NAME

spvmcc - SPVM compiler to create exe file

=head1 SYNOPSIS

  Usage: spvmcc [OPTIONS] [PACKAGE]

    spvmcc -Ilib -Bspvm_build -o my_app My::App

  Options:
    -h, --help                     Show this message
    -v, --version                  Version
    -o, --output                   Excutable file name
    -I, --module-dir <directory>   Add SPVM module searching directory
    -B, --build-dir <directory>    Building diretory
    -q, --quiet                    Quiet output
    -L, --library-dir <directory>  Add native library searching directory
    -l, --library=s <file>         Add native library

=head1 DESCRIPTION

spvmcc is SPVM compiler to create exe file.

Created exe file is executed by itself.
